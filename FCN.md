#### FCN

通常的CNN网络在卷积层之后会接上若干的全连接层，将卷积层产生的特征图映射成一个固定长度的特征向量。

而FCN对图像进行像素级的分类。FCN可以接受任意尺寸的输入图像，采用反卷积层对最后一个卷积层的feature map 进行上采样。使得它恢复到输入图像相同的尺寸。从而可以对每个像素都产生一个预测。同时保留原始输入图像中的空间信息。

**注意**在这里需要对每一个像素计算$softmax$的分类损失。

全连接层和卷积层的不同自傲与神经元只与输入数据中的一个局部区域连接，并且在卷积列中的神经元共享参数。对于任意一个卷积层，都存在一个能够实现和它一样的向前传播的函数的全连接层。反之亦然。



end-to-end,pixels-to-pixels network 

使用转化之后的卷积神经网络进行一次向前传播计算要高效得多。

#### R-FCN

物体检测按照感兴趣的区域池化，给FCN引入了平移变化。用专门的卷积层构建位置敏感分数地图(position-sensitive score map) 每个空间敏感地图编码感兴趣区域的相对空间位置信息。

在这里还使用proposal 的区域建议网络(RPN)提取候选区域。R-FCN最后一个卷积层的输出从整幅图像的卷积响应中分割出感兴趣区域的卷积响应图像。

end-to-end：从处理过的图像$\rightarrow$ 最终目标结果。

对一个大小为$w \times h$ 的ROI，一个bin的大小为$\frac{w}{k} \times \frac{h}{k}$ ，最后一个卷积层为每一类产生$k^2$ 个分数图。对第$( i,j)$个bin，定义一个位置敏感ROI池化操作：

$$r_c(i,j|\Theta)$$为第$c$类第$(i,j)$ 个箱子的池化响应。

每个ROI的损失函数为交叉熵损失和边界框回归损失的和

$$L(s,t_{x,y,w,h})=L_{cls}(s_{c*}) + \lambda[c^* > 0] L_{reg}(t,t^*) =-log(\frac{e^{r_{c*}(\Theta)}}{\sum_{c'=0}^{C}e^{r_{c'}(\Theta)}})+\lambda[c^*>0]L_{reg}(t,t^*)$$

